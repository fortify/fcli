---
title: Fortify CLI (fcli) Developer Information
fcli_version: none
---

<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fortify CLI (fcli) Developer Information</title>

{% include asciidoc-head.html %}

</head>
<body class="article toc2 toc-left">

{% include banner.html bannerTitle="FCLI: The Universal Fortify CLI" currentVersion="[select]" %}


<div id="header">
<h1>Fortify CLI (fcli) Developer Information</h1>
<div class="details">
<span id="revnumber">version none</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_conventional_commits_versioning">Conventional Commits &amp; Versioning</a></li>
<li><a href="#_technologies_frameworks">Technologies &amp; Frameworks</a></li>
<li><a href="#_prerequisites_considerations">Prerequisites &amp; Considerations</a>
<ul class="sectlevel2">
<li><a href="#_ide_setup">IDE Setup</a></li>
<li><a href="#_incremental_compilation">Incremental Compilation</a></li>
<li><a href="#_reflection">Reflection</a></li>
</ul>
</li>
<li><a href="#_gradle_wrapper">Gradle Wrapper</a></li>
<li><a href="#_common_commands">Common Commands</a></li>
<li><a href="#_documentation">Documentation</a>
<ul class="sectlevel2">
<li><a href="#_repository_documentation">Repository Documentation</a></li>
<li><a href="#_user_documentation">User Documentation</a></li>
</ul>
</li>
<li><a href="#_code_style_structure">Code Style &amp; Structure</a>
<ul class="sectlevel2">
<li><a href="#_coding_conventions">Coding Conventions</a></li>
<li><a href="#_package_structure">Package Structure</a></li>
</ul>
</li>
<li><a href="#_implementing_fcli_commands">Implementing fcli Commands</a>
<ul class="sectlevel2">
<li><a href="#_command_structure">Command Structure</a></li>
<li><a href="#_command_implementation">Command Implementation</a></li>
<li><a href="#_commands_options">Commands &amp; Options</a></li>
<li><a href="#_arggroup_annotations">ArgGroup Annotations</a></li>
<li><a href="#_options_vs_positional_parameters">Options vs Positional Parameters</a></li>
<li><a href="#_message_keys">Message Keys</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The following sections provide information that may be useful for developers of this utility.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conventional_commits_versioning"><a class="anchor" href="#_conventional_commits_versioning"></a>Conventional Commits &amp; Versioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Versioning is handled automatically by <a href="https://github.com/google-github-actions/release-please-action">release-please-action</a> based on <a href="https://www.conventionalcommits.org/">Conventional Commits</a>. Every commit to the <code>main</code> branch should follow the Conventional Commits convention. Following are some examples; these can be combined in a single commit message (separated by empty lines), or you can have commit messages describing just a single fix or feature.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>chore: Won't show up in changelog

ci: Change to GitHub Actions workflow; won't show up in changelog

docs: Change to documentation; won't show up in changelog

fix: Some fix (#2)

feat: New feature (#3)

feat!: Some feature that breaks backward compatibility

feat: Some feature
  BREAKING-CHANGE: No longer supports xyz</pre>
</div>
</div>
<div class="paragraph">
<p>See the output of <code>git log</code> to view some sample commit messages.</p>
</div>
<div class="paragraph">
<p><code>release-please-action</code> invoked from the GitHub CI workflow generates pull requests containing updated <code>CHANGELOG.md</code> and <code>version.txt</code> files based on these commit messages. Merging the pull request will result in a new release version being published by creating a GitHub release describing the changes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technologies_frameworks"><a class="anchor" href="#_technologies_frameworks"></a>Technologies &amp; Frameworks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Following is a list of the main frameworks and technologies used by fcli:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://picocli.info/">picocli</a>: Used for fcli command implementations; perform fcli actions, process command line options, generate usage information, generate command output, â€¦</p>
</li>
<li>
<p><a href="https://micronaut.io/">Micronaut</a>: Dependency injection, features for GraalVM native image generation</p>
</li>
<li>
<p><a href="https://github.com/FasterXML/jackson">Jackson</a>: Parse and generate data in JSON and other formats</p>
</li>
<li>
<p><a href="https://www.graalvm.org/">GraalVM</a>: Generate native images (native executables)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites_considerations"><a class="anchor" href="#_prerequisites_considerations"></a>Prerequisites &amp; Considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As can be seen in the <a href="#_technologies_frameworks">Technologies &amp; frameworks</a> section, this is no ordinary Java project. Some of these technologies and frameworks require special prerequisites, precautions and other considerations to be taken into account to prevent compilation issues and runtime errors, as described below.</p>
</div>
<div class="sect2">
<h3 id="_ide_setup"><a class="anchor" href="#_ide_setup"></a>IDE Setup</h3>
<div class="paragraph">
<p>This project uses the following frameworks that may require some special setup in order to have your IDE compile this project without errors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lombok: Please see <a href="https://projectlombok.org/setup/overview" class="bare">https://projectlombok.org/setup/overview</a> for more information on how to add Lombok support to your IDE</p>
</li>
<li>
<p>Micronaut &amp; picocli: These frameworks require annotation processors to be run during builds; please see your IDE documentation on how to enable annotation processing</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_incremental_compilation"><a class="anchor" href="#_incremental_compilation"></a>Incremental Compilation</h3>
<div class="paragraph">
<p>Incremental compilation (for example in IDE or when doing a <code>gradle build</code> without <code>clean</code>) may leave behind old AOT artifacts causing exceptions when trying to run <code>fcli</code>. This is especially the case when renaming or moving classes, which may result in exceptions like the below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Message: Error loading bean [com.fortify.cli.ssc.rest.unirest.SSCUnirestRunner]: com/fortify/cli/rest/unirest/AbstractUnirestRunner
...
Caused by: java.lang.NoClassDefFoundError: com/fortify/cli/rest/unirest/AbstractUnirestRunner
...</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the AbstractUnirestRunner class was moved to a different package, but the now obsolete AOT-generated classes were still present. So, if at any time you see unexpected exceptions, please try to do a full clean/rebuild and run <code>fcli</code> again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reflection"><a class="anchor" href="#_reflection"></a>Reflection</h3>
<div class="paragraph">
<p>GraalVM Native Image needs to know ahead-of-time the reflectively accessed program elements; see <a href="https://www.graalvm.org/reference-manual/native-image/Reflection/">GraalVM Native Image &amp; Reflection</a> for details.</p>
</div>
<div class="paragraph">
<p>In fcli, the following needs to be taken into account to avoid reflection issues in native fcli binaries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Micronaut <code>@Inject</code> annotations must not be declared on private fields</p>
<div class="ulist">
<ul>
<li>
<p>To inject beans into fields, use <code>@Setter(onMethod=@__({@Inject}))</code> to have Lombok generate a setter method with <code>@Inject</code> annotation, allowing Micronaut to perform injection without requiring reflection.</p>
</li>
<li>
<p>Failure to do so will often result in native fcli binaries from running altogether; this will usually be detected during the basic fcli test performed in the GitHub <code>Build &amp; release</code> workflow.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All classes referenced in <code>@ProductHelperClass</code> annotations, i.e. all <code>&lt;Product&gt;ProductHelper</code> classes, must be annotated with <code>@ReflectiveAccess</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Failure to do so will prevent most <code>&lt;Product&gt;</code>-specific commands from running when using the native fcli binaries.</p>
</li>
<li>
<p>This may not be uncovered by the basic fcli test mentioned above, but should be fairly easy to detect, for example through product module integration tests or through manual testing of arbitrary product commands.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All data classes that are serialized or deserialized using Jackson must be annotated with the <code>@ReflectiveAccess</code> annotation.</p>
<div class="ulist">
<ul>
<li>
<p>Failure to do so will cause errors when serializing or deserializing data to or from classes that lack this annotation.</p>
</li>
<li>
<p>Usually this only affects a small group of commands or a single command, possibly even only under certain conditions, and as such any missing annotations may be difficult to detect.</p>
</li>
<li>
<p>Most notably, the following classes will need the <code>@ReflectiveAccess</code> annotation:</p>
<div class="ulist">
<ul>
<li>
<p>Most <code>*Descriptor</code> classes.</p>
</li>
<li>
<p>Classes holding REST request or response data.</p>
</li>
<li>
<p>Classes holding data stored in the fcli data folder, like configuration data classes.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Picocli uses reflection internally, which in earlier fcli versions required <code>@ReflectiveAccess</code> annotations on picocli-related classes like commands and mixins. However, recent fcli versions generate a proper Graal reflect-config.json file, so <code>@ReflectiveAccess</code> is no longer needed on picocli-related classes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a command runs fine on a regular JVM but not when running as a native image, then quite likely this is caused by missing reflection configuration which may be fixed by adding the <code>@ReflectiveAccess</code> annotation to the appropriate classes.</p>
</div>
<div class="paragraph">
<p>Note that Micronaut also provides the <code>@Introspected</code> annotation that should allow for reflection-free (de-)serialization. However experience learns that there are just too many differences between reflection-based and introspection-based (de-)serialization. When running in a normal JVM these differences are often not visible as Jackson can easily fall back to reflection-based (de-)serialization. In native images, Jackson cannot fall back to reflection-based (de-)serialization unless properly configured, and even when properly configured there are still some differences in behavior.</p>
</div>
<div class="paragraph">
<p>As such, it has been decided to disable Jackson introspection-based (de-)serialization using the <code>jackson.bean-introspection-module</code> configuration property in <code>application.yml</code>. This also means that we will not be using the <code>@Introspected</code> annotation on classes that need to be (de-)serialized with Jackson. The alternative is to use the <code>@ReflectiveAccess</code> annotation on such classes, as described above.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_wrapper"><a class="anchor" href="#_gradle_wrapper"></a>Gradle Wrapper</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is strongly recommended to build this project using the included Gradle Wrapper scripts; using other Gradle versions may result in build errors and other issues.</p>
</div>
<div class="paragraph">
<p>The Gradle build uses various helper scripts from <a href="https://github.com/fortify/shared-gradle-helpers" class="bare">https://github.com/fortify/shared-gradle-helpers</a>; please refer to the documentation and comments in included scripts for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_commands"><a class="anchor" href="#_common_commands"></a>Common Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All commands listed below use Linux/bash notation; adjust accordingly if you are running on a different platform. All commands are to be executed from the main project directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>./gradlew tasks --all</code>: List all available tasks</p>
</li>
<li>
<p>Build: (plugin binary will be stored in <code>build/libs</code>)</p>
<div class="ulist">
<ul>
<li>
<p><code>./gradlew clean build</code>: Clean and build the project</p>
</li>
<li>
<p><code>./gradlew build</code>: Build the project without cleaning</p>
</li>
<li>
<p><code>./gradlew dist distThirdParty</code>: Build distribution zip and third-party information bundle</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documentation"><a class="anchor" href="#_documentation"></a>Documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Two types of documentation are automatically being generated; the standard repository documentation like <code>README.md</code> and <code>CONTRIBUTING.md</code>, and fcli user documentation (including manual pages). The following two sections describe the generation process in more detail.</p>
</div>
<div class="sect2">
<h3 id="_repository_documentation"><a class="anchor" href="#_repository_documentation"></a>Repository Documentation</h3>
<div class="paragraph">
<p>Most or all of the <code>*.md</code> and <code>LICENSE.txt</code> files located in the repository root are generated automatically. Generation of <code>CHANGELOG.md</code> is done by <code>release-please-action</code> as described in the <a href="#_conventional_commits_versioning">Conventional Commits &amp; Versioning</a> section. Generation of the other files is done by the <code>doc-resources/update-repo-docs.sh</code> scripts, based on the templates provided in <a href="https://github.com/fortify/shared-doc-resources" class="bare">https://github.com/fortify/shared-doc-resources</a>, combined with the repo-specific MarkDown files in the repository <code>doc-resources</code> directory. For more information about this generation process, please see <a href="https://github.com/fortify/shared-doc-resources/blob/main/USAGE.md" class="bare">https://github.com/fortify/shared-doc-resources/blob/main/USAGE.md</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_user_documentation"><a class="anchor" href="#_user_documentation"></a>User Documentation</h3>
<div class="paragraph">
<p>User documentation is generated automatically from the following three locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AsciiDoc located in the repository <code>doc-resources/asciidoc/gh-pages</code> directory</p>
<div class="ulist">
<ul>
<li>
<p>Published to the root directory of the GitHub Pages site</p>
</li>
</ul>
</div>
</li>
<li>
<p>AsciiDoc located in the repository <code>doc-resources/asciidoc/versioned</code> directory</p>
<div class="ulist">
<ul>
<li>
<p>Published to a version-specific directory on the GitHub Pages site</p>
</li>
<li>
<p>Published to docs-html.zip in release assets</p>
</li>
</ul>
</div>
</li>
<li>
<p>Manual pages generated from the fcli code</p>
<div class="ulist">
<ul>
<li>
<p>Published to a version-specific directory on the GitHub Pages site</p>
</li>
<li>
<p>Published to docs-html.zip in release assets</p>
</li>
<li>
<p>Published to docs-manpage.zip in release assets</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Gradle build includes various tasks for generating this documentation, following are the main tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>generateManpageAsciiDoc</code>: Generate man-page style AsciiDoc documentation from fcli code</p>
</li>
<li>
<p><code>asciiDoctorManPage</code>: Convert man-page style AsciiDoc to Linux man-page format</p>
</li>
<li>
<p><code>asciiDoctorHtml</code>: Convert both man-page style AsciiDoc and versioned user documentation to offline HTML format</p>
</li>
<li>
<p><code>asciidoctorJekyll</code>: Convert both man-page style AsciiDoc and versioned user documentation to Jekyll HTML format for publishing on the GitHub Pages site</p>
</li>
<li>
<p><code>asciidoctorGHPages</code>: Convert AsciiDoc files from <code>doc-resources/asciidoc/gh-pages</code> to Jekyll HTML format for publishing on the GitHub Pages site</p>
</li>
<li>
<p><code>distDocs</code>: Calls of the tasks above and packages the output from these tasks into separate <code>docs-*.zip</code> files in the <code>build/dist</code> directory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The GitHub Actions workflow defined in <code>.github/workflows/ci.yml</code> is responsible for publishing the documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>build</code> job builds the documentation artifacts and archives them as artifacts</p>
</li>
<li>
<p>The <code>release</code> job publishes <code>docs-html.zip</code> and <code>docs-manpage.zip</code> to the release artifacts (when building a release or development version)</p>
</li>
<li>
<p>The <code>publishPages</code> job published the output of the <code>asciidoctorJekyll</code> and <code>asciidoctorGHPages</code> to the appropriate directories on the GitHub Pages site, and updates the version index in the Jekyll <code>_data</code> directory (when building a release or development version)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All HTML-formatted documentation described above is generated using the <code>doc-resources/templates/html5/document.html.erb</code> template. This template is based on the <a href="https://github.com/asciidoctor/asciidoctor-backends/blob/master/erb/html5/document.html.erb">official AsciiDoctor template</a> with various modifications. Based on the attributes provided in the relevant Gradle tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Jekyll output:</p>
<div class="ulist">
<ul>
<li>
<p>Add Jekyll front matter</p>
</li>
<li>
<p>Add a Jekyll include to include additional content in the HTML <code>&lt;head&gt;</code> section; mostly used for applying stylesheets</p>
</li>
<li>
<p>Add a Jekyll include to include the site-wide banner and (version) navigation bar</p>
</li>
</ul>
</div>
</li>
<li>
<p>For offline HTML output:</p>
<div class="ulist">
<ul>
<li>
<p>Add hardcoded custom styling</p>
</li>
<li>
<p>Add hardcoded banner and version bar</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The offline HTML documentation is supposed to be self-contained, i.e., pages should render correctly, without having to extract the full contents, if users open any HTML file from <code>docs-html.zip</code>. In particular, this means that styles and images need to be embedded inside the HTML files. Of course, links to other documentation files will not work unless the full zip-file is extracted.</p>
</div>
<div class="paragraph">
<p>For now, the hardcoded banner and navigation bar in the offline documentation is similar to the banner included by Jekyll. However:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Stylesheets and images are linked rather than being included in the HTML page, allowing for better browser cache utilization</p>
</li>
<li>
<p>The navigation bar in the offline documentation contains just a static version number, whereas the navigation bar in the online documentation allows for navigating to different versions</p>
</li>
<li>
<p>We can potentially add more advanced (navigation) functionalities in the online documentation</p>
</li>
<li>
<p>We can easily update the banner for the online documentation to have a new layout/styling, for example to apply OpenText styling; this will be automatically applied to all existing online documentation pages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Usually it shouldn&#8217;t be necessary to update the documentation contents for existing release versions. However, if necessary, and assuming the build.gradle file is compatible with older versions, potentially a command like the following can be used to regenerate the documentation for the given versions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>for v in 1.0.0 1.0.1 1.0.2 1.0.3 1.0.4 1.0.5 1.1.0 1.2.0 1.2.1 1.2.2; do (git restore . &amp;&amp; git clean -fd &amp;&amp; git checkout v$v &amp;&amp; cp -r ../fcli-fork/doc-resources ../fcli-fork/build.gradle . &amp;&amp; ./gradlew clean distDocs -Pversion=$v &amp;&amp; mkdir -p ~/Downloads/fcli-docs/$v &amp;&amp; cp build/dist/docs-html.zip ~/Downloads/fcli-docs/$v &amp;&amp; cd ../fcli-pages/v$v &amp;&amp; echo $pwd &amp;&amp; rm -rf * &amp;&amp; unzip ../../fcli/build/dist/docs-jekyll.zip &amp;&amp; cd - &amp;&amp; git restore . &amp;&amp; git clean -fd); done</pre>
</div>
</div>
<div class="paragraph">
<p>This command iterates over the given version numbers, regenerates the documentation for each version (using latest <code>build.gradle</code> and <code>doc-resources</code>), copies the <code>docs-html.zip</code> to a separate directory for later upload to the corresponding release assets, and updates the GitHub Pages site, based on the following assumptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Current directory is a clone of the fcli repository</p>
</li>
<li>
<p><code>../fcli-fork</code> would contain the latest version of <code>doc-resources</code> and <code>build.gradle</code></p>
</li>
<li>
<p><code>../fcli-pages</code> would be a clone of the fcli repository with the gh-pages branch checked out</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_style_structure"><a class="anchor" href="#_code_style_structure"></a>Code Style &amp; Structure</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_coding_conventions"><a class="anchor" href="#_coding_conventions"></a>Coding Conventions</h3>
<div class="paragraph">
<p>Common Java coding conventions should be used for fcli source code, taking the following into consideration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Indentation is done using 4 spaces; fcli source code should not contain tabs.</p>
</li>
<li>
<p>Use of System.out and System.err should be avoided, except for code that explicitly handles output.</p>
<div class="ulist">
<ul>
<li>
<p>Command output should be generated through the output framework provided in the common module.</p>
</li>
<li>
<p>The logging framework should be used for outputting warning messages for example.</p>
</li>
<li>
<p>If you use System.out for debugging, potentially commenting out or removing these statements once done with debugging, consider using the logging framework for debug logging. If you need this information for debugging, it may be useful to permanently have this information included in debug logs.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Avoid having commented out source code.</p>
</li>
<li>
<p>Use the 'Organize Imports` feature of the IDE to remove any unused imports.</p>
</li>
<li>
<p>Avoid having unused variables, methods, &#8230;&#8203;</p>
</li>
<li>
<p>Avoid unsafe type conversions. In particular, when using Jackson for deserializing generic types, use <code>TypeReference</code> instead of the generic type class.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_package_structure"><a class="anchor" href="#_package_structure"></a>Package Structure</h3>
<div class="paragraph">
<p>Most fcli command modules use the package structure described below. Note that there may be slight variations between product-specific modules that interact with a remote system, and fcli-specific modules like <code>config</code> and <code>tool</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.fortify.cli.&lt;module&gt;</code><br></p>
<div class="ulist">
<ul>
<li>
<p>Root package for the given module</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;._main.cli.cmd</code></p>
<div class="ulist">
<ul>
<li>
<p>Contains <code>&lt;module&gt;Commands</code> class listing all entity commands for the given module.</p>
</li>
<li>
<p>May contain command implementations that operate at module-level rather than entity-level, like the <code>ConfigClearCommand</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.&lt;entity&gt;</code></p>
<div class="ulist">
<ul>
<li>
<p>Root package for the given module entity</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.&lt;entity&gt;.cli</code></p>
<div class="ulist">
<ul>
<li>
<p>Root package for Picocli-based code, like command implementations and mixins</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.&lt;entity&gt;.cli.cmd</code></p>
<div class="ulist">
<ul>
<li>
<p>Contains the <code>&lt;module&gt;&lt;entity&gt;Commands</code> class, listing all sub-commands for the given entity</p>
</li>
<li>
<p>Contains the individual entity action command classes</p>
</li>
<li>
<p>Where appropriate, sub-packages may be used to group related action commands</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.&lt;entity&gt;.cli.mixin</code></p>
<div class="ulist">
<ul>
<li>
<p>Contains classes used as Mixin classes, for example defining reusable options and parameters, which may be used by commands in the current entity but also by other entities.</p>
</li>
<li>
<p>May contain classes used as ArgGroups, but these should be used sparingly as noted in <a href="_arggroup_annotations">ArgGroup Annotations</a></p>
</li>
<li>
<p>Usually contains a <code>&lt;module&gt;&lt;entity&gt;ResolverMixin</code> class, containing inner classes that allow for resolving one or more <code>&lt;entity&gt;</code> instances based on command-line options and/or positional parameters. Each inner class name describes the provided functionality, like <code>RequiredOption</code>, <code>OptionalOption</code>, <code>RequiredPositionalParameter</code>, &#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.&lt;entity&gt;.helper</code></p>
<div class="ulist">
<ul>
<li>
<p>Contains entity-related helper classes, for example for loading entity data, deleting entities, &#8230;&#8203;</p>
</li>
<li>
<p>Contains <code>*Descriptor</code> classes that hold entity-related data</p>
</li>
<li>
<p>Classes in this package should not contain any picocli-related functionality; they should be designed in such a way that they could potentially be used in non-picocli applications</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.output</code></p>
<div class="ulist">
<ul>
<li>
<p>Root package for generic, module-specific output functionality</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.output.cli.cmd</code></p>
<div class="ulist">
<ul>
<li>
<p>Contains a module-specific <code>Abstract&lt;module&gt;OutputCommand</code> class extending from either <code>AbstractBasicOutputCommand</code> or <code>AbstractUnirestOutputCommand</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.output.cli.mixin</code></p>
<div class="ulist">
<ul>
<li>
<p>Contains a module-specific <code>&lt;module&gt;OutputHelperMixins</code> class, containing inner classes for every action provided by the module, like <code>List</code>, <code>Get</code>, <code>Delete</code>, <code>Revoke</code>, &#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.rest</code></p>
<div class="ulist">
<ul>
<li>
<p>Root package for module-specific REST-related functionality</p>
</li>
<li>
<p>Contents may vary depending on the target system</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.rest.cli.cmd</code></p>
<div class="ulist">
<ul>
<li>
<p>Contains <code>&lt;module&gt;RestCommands</code> and <code>&lt;module&gt;RestCallCommand</code> classes that implement the <code>fcli &lt;module&gt; rest call</code> command structure</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>com.fortify.cli.&lt;module&gt;.rest.cli.mixin</code></p>
<div class="ulist">
<ul>
<li>
<p>Contains one or more mixin classes responsible for handling connections to the target system</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementing_fcli_commands"><a class="anchor" href="#_implementing_fcli_commands"></a>Implementing fcli Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections provide information on implementing fcli commands.</p>
</div>
<div class="sect2">
<h3 id="_command_structure"><a class="anchor" href="#_command_structure"></a>Command Structure</h3>
<div class="paragraph">
<p>In general, we try to adhere to the following fcli command structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fcli &lt;module&gt; &lt;entity&gt; &lt;action&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;module&gt;</code> represents either a product like <code>ssc</code> or <code>fod</code>, or an fcli-specific module like <code>config</code>, <code>state</code>, <code>tool</code> or <code>util</code>.</p>
</li>
<li>
<p><code>&lt;entity&gt;</code> represents the entity on which the <code>&lt;action&gt;</code> sub-commands operate, like <code>app</code>, <code>appversion</code> or <code>appversion-attribute</code>. Virtually every entity should have its own top-level command inside a <code>&lt;module&gt;</code>, we usually don&#8217;t use nested entities like <code>app&#8594;version&#8594;attribute</code>.</p>
</li>
<li>
<p><code>&lt;action&gt;</code> represents the action to be taken on the <code>&lt;entity&gt;</code> and is usually a verb like <code>list</code>, <code>get</code>, <code>set</code>, <code>delete</code>, <code>update</code>, &#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p>If there are multiple variants of a particular command, <code>&lt;action&gt;</code> may include a suffix after the verb, like <code>download-by-id</code> and <code>download-state</code>, or <code>purge-by-id</code> and <code>purge-by-date</code>.</p>
</li>
<li>
<p>Aliases should be used to maintain backward compatibility if needed. For example, if there is already a <code>delete</code> command that deletes by id, and a new command for deleting by date needs to be added, the original command would be renamed to <code>delete-by-id</code> with alias <code>delete</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Fcli commands should be atomic and specific in nature. Each command should only do one thing, and do it well. A clear example are the <code>wait-for</code> commands that provide a lot of wait-related options, rather than having the wait-related options on the command that initiated the action that we&#8217;re waiting for.</p>
</div>
<div class="paragraph">
<p>In general, exclusive options that influence the outcome of a command are an indication that a command is not specific enough; in such cases you may want to consider having multiple variants of the same command as described above. For example, if you are considering a single <code>purge</code> command with exclusive options <code>--id &lt;id&gt;</code> and <code>--older-than &lt;date&gt;</code>, then having more specific <code>purge-by-id</code> and <code>purge-by-date</code> or even <code>purge-older-than</code> commands would be more appropriate.</p>
</div>
<div class="paragraph">
<p>As usual, there are some exceptions to this rule, in particular for commands that are consistently named across fcli modules. For example, login commands often allow for logging in with either user or token credentials; for consistency we just have a single login command that provides options for either approach.</p>
</div>
<div class="paragraph">
<p>In general, each container command should contain either only leaf commands, or only container commands. For example, the top-level <code>&lt;module&gt;</code> command should usually only contain <code>&lt;entity&gt;</code> container commands and no leaf commands, whereas <code>&lt;entity&gt;</code> commands should usually only contain leaf commands. There are some exceptions to this rule though, for example if a command operates on all entities within a module, like the <code>fcli config clear</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_command_implementation"><a class="anchor" href="#_command_implementation"></a>Command Implementation</h3>
<div class="paragraph">
<p>Most or all product-specific leaf command implementations should have the following generic structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Command(name = [Module]OutputHelperMixins.&lt;Action&gt;.CMD_NAME)
public class &lt;Module&gt;&lt;Entity&gt;&lt;Action&gt;Command extends &lt;SuperClass&gt; implements &lt;CommonInterfaces&gt; {
    @Getter @Mixin private [Module]OutputHelperMixins.&lt;Action&gt; outputHelper;
    // Options, positional parameters, other fields; see next sections for info on options and parameters

    // Overrides for interfaces, for example methods generating the output data,
    // record transformations, ...

    @Override
    public boolean isSingular() {
        return &lt;false if potentially returning multiple records, true if always returning single record&gt;;
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;Module&gt;</code>: Corresponds to the module in which this class is located; for product-specific commands this would correspond to the product name like <code>SSC</code> or <code>FoD</code>.</p>
</li>
<li>
<p><code>[Module]</code>: Commands can use <code>IOutputHelper</code> implementations from either the generic <code>OutputHelperMixins</code> or the module-specific <code>[Module]OutputHelperMixins</code></p>
</li>
<li>
<p><code>&lt;Entity&gt;</code> represents the entity that the command is operating on, like <code>App</code>, <code>AppVersion</code>, <code>User</code>, &#8230;&#8203;</p>
</li>
<li>
<p><code>&lt;Action&gt;</code>: Represents the action performed by this command; should be one of the classes in the <code>[Module]OutputHelperMixins</code> class, like <code>Get</code>, <code>List</code>, <code>Delete</code>, &#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p>Every action should have a corresponding inner class in either the generic <code>OutputHelperMixins</code> class, or the module-specific <code>[Module]OutputHelperMixins</code> class.</p>
</li>
<li>
<p>In general, only concrete command implementations should declare references to <code>*OutputHelperMixins</code> classes, both in the <code>@Command</code> declaration and the <code>outputHelper</code> field. Defining an <code>outputHelper</code> field in an (abstract) superclass will result in any aliases defined on <code>*OutputHelperMixins</code> inner classes not being applied to the concrete command implementations.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>&lt;SuperClass&gt;</code> is usually <code>Abstract&lt;Module&gt;OutputCommand</code> or one of its abstract subclasses. Most modules provide <code>Abstract&lt;Module&gt;JsonNodeOutputCommand</code> and <code>Abstract&lt;Module&gt;BaseRequestOutputCommand</code> as bases classes for commands that generate <code>JsonNode</code> or <code>HttpRequest</code> instances respectively. Indirectly, virtually all leaf commands should extend from  <code>AbstractOutputCommand</code>.</p>
</li>
<li>
<p><code>&lt;CommonInterfaces&gt;</code> is a list of interfaces that define how output is being generated and processed. Following are some commonly used interfaces; see JavaDoc for details on usage:</p>
<div class="ulist">
<ul>
<li>
<p><code>IBaseRequestSupplier</code>: Supply a Unirest <code>HttpRequest</code> instance for retrieving command output data.</p>
</li>
<li>
<p><code>IJsonNodeSupplier</code>: Supply a <code>JsonNode</code> instance representing the command output.</p>
</li>
<li>
<p><code>IActionCommandResultSupplier</code>: Supply data for a result column to be included in the output, like <code>DELETED</code>, <code>CREATED</code>, &#8230;&#8203;</p>
</li>
<li>
<p><code>IInputTransformer</code>: Allows for transforming the full JSON data before it is being processed for output.</p>
</li>
<li>
<p><code>IRecordTransformer</code>: Allows for transforming individual records before they are being processed for output.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Leaf commands in non-product modules usually have a similar structure, but some details may be different. Container commands, i.e. commands that represent <code>&lt;module&gt;</code> and <code>&lt;entity&gt;</code> have a very different (easier) structure as they don&#8217;t have any actual functionality associated to them; please refer to existing fcli container commands to serve as an example.</p>
</div>
</div>
<div class="sect2">
<h3 id="_commands_options"><a class="anchor" href="#_commands_options"></a>Commands &amp; Options</h3>
<div class="paragraph">
<p>Commands (including aliases) and options should use kebab-case names, i.e., lower-case names with words separated by a dash.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Acceptable command/option names: <code>app</code>, <code>appversion-artifact</code></p>
</li>
<li>
<p>Invalid command/option names: <code>App</code>, <code>appversionArtifact</code>, <code>appversion_artifact</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Commands may have one or more aliases, and multiple names may be defined for options. Having multiple names for a single command or option may be useful for various reasons, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For providing shorter names, resulting in less typing for the user.</p>
</li>
<li>
<p>To maintain backward compatibility when renaming an existing command or option</p>
</li>
<li>
<p>As a 'default' command or option name if there are multiple variants of the same command or option, for example <code>purge</code> as the an alias for <code>purge-by-id</code> to have this as the default 'purge' operation if there are also other <code>purge-*</code> commands.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each command and option should have at most two names; the full name and a shorter form. For options, the shorter form is usually a single-letter option.</p>
</li>
<li>
<p>Having more than two names is only allowed if needed for backward compatibility; the backward-compatible name(s) should be removed on the next major release.</p>
</li>
<li>
<p>Options should always have a full name to describe their meaning, short (single-letter) name is optional.</p>
</li>
<li>
<p>Single-letter options are preceded by <code>-</code> (single dash), multi-letter options are preceded by <code>--</code> (double dash).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_arggroup_annotations"><a class="anchor" href="#_arggroup_annotations"></a>ArgGroup Annotations</h3>
<div class="paragraph">
<p>It was decided that <code>ArgGroup</code> annotations should be used sparingly (<a href="https://github.com/fortify/fcli/issues/89">Issue #89</a>). <code>ArgGroup</code> annotations are mostly used for generic options, like logging, help, output and query options. In general, command-specific options should use <code>ArgGroup</code> annotations only for defining exclusive options, not for creating a separate section in the help output.</p>
</div>
</div>
<div class="sect2">
<h3 id="_options_vs_positional_parameters"><a class="anchor" href="#_options_vs_positional_parameters"></a>Options vs Positional Parameters</h3>
<div class="paragraph">
<p>It was decided that every fcli command should have at most one positional parameter definition to specify the primary entity id or name that the command operates on. For example, <code>&lt;entity&gt; delete</code> commands can have a positional parameter for specifying the entity name or id to be deleted, usually matching the <code>&lt;entity&gt;</code> command group that the command is located at. For example, an <code>app delete</code> command would take a positional parameter for identifying the <code>app</code> to be deleted. Potentially the positional parameter may be an array or collection, for example if the <code>app delete</code> command allows for deleting multiple apps in a single operation.</p>
</div>
<div class="paragraph">
<p>For everything else, including parent entities, options should be used. As an example, the <code>fcli ssc appversion-attribute set</code> command takes the parent entity (application version) as an option named <code>--appversion</code>, whereas the attribute names and values to be set are taken as a positional parameter <code>Map</code> instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_message_keys"><a class="anchor" href="#_message_keys"></a>Message Keys</h3>
<div class="paragraph">
<p>In general, standard picocli conventions should be used for locating i18n message keys for options, positional parameters, command descriptions, and so on. In some cases, it may be necessary to configure explicit messages keys in picocli annotations, for example for options and parameters defined in command super-classes or mixins.</p>
</div>
<div class="paragraph">
<p>As an example, take the <code>@Option</code> <code>descriptionKey</code> attributes in the <code>AbstractToolInstallCommand</code>, specifying a fixed description key for all sub-commands. This way, the option description only needs to be specified once in the resource bundle, whereas using the standard picocli conventions would potentially have resulted in requiring the option description to be repeated for every individual command that extends from <code>AbstractToolInstallCommand</code>.</p>
</div>
<div class="paragraph">
<p>Ideally, all commands, options and positional parameters should have a proper description. The following Linux commands can be used to find missing descriptions for options and commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check which options don&#8217;t have a description:<br>
<code>./gradlew build generateManpageAsciiDoc &amp;&amp;  grep -e "^\\*-.*::" -A 1 build/generated-picocli-docs/*.adoc | grep -e "^build.*-\s*$" -B 1</code></p>
</li>
<li>
<p>Check which commands don&#8217;t have a usage header (inheriting the header of the root command):<br>
<code>./gradlew build &amp;&amp; java -jar build/libs/fcli.jar util all-commands list --include-parents | fgrep "Command-line interface for working with"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where applicable, option and positional parameter descriptions should include references to other related fcli commands, in particular when these related commands are in a separate command tree. For example, available attribute names and values that can be specified on the <code>fcli ssc appversion-attribute set</code> command can be found through the <code>fcli ssc attribute-definition *</code> commands. Being in a separate command tree, this may not be obvious to users and as such should be documented on the <code>fcli ssc appversion-attribute set</code> command.</p>
</div>
<div class="paragraph">
<p>Comparing this to the 'application name or id' to be passed to the <code>fcli ssc app get</code> command; available application id&#8217;s can be found through the <code>fcli ssc app list</code> command under the same <code>app</code> parent command, so this doesn&#8217;t need to be documented as it should be obvious to users.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version none<br>
Last updated 2023-05-14 11:35:33 UTC
</div>
</div>
</body>
</html>